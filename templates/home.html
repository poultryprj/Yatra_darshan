{% load static %}
{% load i18n %}
{% load pwa %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yatra Darshan - Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="manifest" href="{% static 'assets/__manifest.json' %}">

  <style>
    /* palette & base */
    :root{
      --brand-orange: #ff7b00;
      --brand-blue: #003399;
      --brand-green: #006633;
    }
    body{ background:#f0f2f5; font-family: Arial, sans-serif; margin:0; padding:0; }

    /* top navbar */
    .navbar{ background:var(--brand-orange); height:55px; }
    .navbar-brand{ color:#fff; font-weight:600; font-size:18px; }
    .navbar-toggler{ border:none; background:#fff; border-radius:6px; padding:6px 8px; }

    /* drawer */
    .drawer{ position:fixed; top:55px; left:-100%; width:68%; height:calc(100% - 55px); background:#fff; transition:left .28s; z-index:1100; box-shadow:2px 0 8px rgba(0,0,0,.08); overflow:auto; }
    .drawer.open{ left:0; }
    .drawer .additional-content{ padding:12px; text-align:center; background:#f8f9fb; position:sticky; top:0; }
    .drawer ul{ padding:12px; }
    .drawer ul li{ list-style:none; margin-bottom:6px; }
    
    /* Home page specific styles */
    .container-home { max-width: 600px; margin: 100px auto 40px; padding: 20px; }
    .home-button {
        display: block;
        width: 100%;
        padding: 20px;
        margin-bottom: 20px;
        font-size: 1.5rem;
        font-weight: 600;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        text-align: center;
        text-decoration: none;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .home-button:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
    .btn-registration { background-color: var(--brand-blue); color: #fff; }
    .btn-diwali { background-color: var(--brand-green); color: #fff; }


    .btn-event {
    background: linear-gradient(90deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 15px 25px;
    font-weight: 600;
    text-align: center;
    display: block;
    text-decoration: none;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
    transition: all 0.3s ease-in-out;
}
.btn-event:hover {
    transform: translateY(-3px) scale(1.03);
    box-shadow: 0 8px 30px rgba(118, 75, 162, 0.6);
}


 /* --- NEW STYLES FOR ATTRACTIVE DROPDOWNS --- */
    .drawer a {
        border-radius: 8px;
        transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        font-weight: 500;
    }
    .drawer a:hover {
        background-color: var(--light-gray);
        color: var(--brand-orange) !important;
    }
    /* Style for the main dropdown trigger link */
    .drawer a[data-bs-toggle="collapse"] {
        position: relative;
        background-color: #f8f9fa;
    }
    /* Chevron icon for the dropdown trigger */
    .drawer a[data-bs-toggle="collapse"]::after {
        content: '\f282'; /* Bootstrap Icons chevron down */
        font-family: 'bootstrap-icons';
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        transition: transform 0.3s ease;
        font-weight: bold;
    }
    /* Rotate chevron when dropdown is open */
    .drawer a[data-bs-toggle="collapse"][aria-expanded="true"]::after {
        transform: translateY(-50%) rotate(180deg);
    }
    /* Style for the active/open dropdown trigger */
    .drawer a[data-bs-toggle="collapse"][aria-expanded="true"] {
        background-color: var(--brand-orange);
        color: white !important;
    }
    /* Style for the submenu container */
    .submenu {
        padding-left: 20px !important;
        margin-left: 10px;
        border-left: 2px solid #e9ecef;
    }
    /* Style for individual links within the submenu */
    .submenu a {
        font-size: 0.95rem;
        color: #555 !important;
    }
    .submenu a:hover {
        background-color: #f0f2f5;
    }

  </style>
</head>
<body>

<!-- Topbar with Menu Button -->
<nav class="navbar navbar-expand-lg fixed-top">
  <div class="container-fluid d-flex align-items-center justify-content-center position-relative">
    <button id="menuBtn" class="navbar-toggler" type="button" style="position:absolute; left:12px;">
      <span class="navbar-toggler-icon"></span>
    </button>
    <span class="navbar-brand" style="position:absolute; left:50%; transform:translateX(-50%);">
      Welcome - {{ user.first_name }} {{ user.last_name }}
    </span>
  </div>
</nav>

<!-- Side Drawer -->
<div id="drawer" class="drawer">
  <div class="additional-content">
    <img src="{% static 'assets/img/lakshya_pratishthan.png' %}" width="92" height="92" class="rounded-circle" alt="logo">
    <div style="margin-top:8px;"><b style="color:#000;">Darshan Yatra</b></div>
    <button onclick="closeDrawer()" class="btn btn-sm position-absolute" style="right:8px; top:8px;"><i class="bi bi-x-lg"></i></button>
  </div>
  <ul>
    <li>
        <a href="{% url 'home' %}" class="text-decoration-none text-dark d-block py-2">
            <i class="bi bi-house-door me-2"></i> Home
        </a>
    </li>

    <!-- Yatra Booking Section -->
    <li>
        <a href="#yatraSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="text-decoration-none text-dark d-block py-2">
            <i class="bi bi-person-plus-fill me-2"></i> Yatra Booking
        </a>
        <ul class="collapse list-unstyled submenu" id="yatraSubmenu">
            {% if request.session.user_role != "2" %}
                <li>
                    <a href="{% url 'user_master' %}" class="text-decoration-none text-dark d-block py-2">
                        <i class="bi bi-people-fill me-2"></i> User Management
                    </a>
                </li>
                <li>
                    <a href="{% url 'route_master' %}" class="text-decoration-none text-dark d-block py-2">
                        <i class="bi bi-geo-alt-fill me-2"></i> Route Master
                    </a>
                </li>
                <li>
                    <a href="{% url 'area_master' %}" class="text-decoration-none text-dark d-block py-2">
                        <i class="bi bi-map-fill me-2"></i> Area Master
                    </a>
                </li>
                <li>
                    <a href="{% url 'yatra_master' %}" class="text-decoration-none text-dark d-block py-2">
                        <i class="bi bi-calendar-event-fill me-2"></i> Yatra Master
                    </a>
                </li>
            {% endif %}
            <li>
                <a href="{% url 'daily_report' %}" class="text-decoration-none text-dark d-block py-2">
                    <i class="bi bi-cash-coin me-2"></i> Daily Collection
                </a>
            </li>
            <li>
                <a href="{% url 'print_report_page' %}" class="text-decoration-none text-dark d-block py-2">
                    <i class="bi bi-printer-fill me-2"></i> Print Report
                </a>
            </li>
            <li>
                <a href="{% url 'passenger_documents' %}" class="text-decoration-none text-dark d-block py-2">
                    <i class="bi bi-person-badge me-2"></i> Passenger Docs
                </a>
            </li>
            <li>
              <a href="{% url 'area_report' %}" class="text-decoration-none text-dark d-block py-2"><i class="bi bi-pin-map-fill me-2"></i> Area Report</a>
            </li>


            <li>
                <a href="{% url 'whatsapp_messaging_page' %}" class="text-decoration-none text-dark d-block py-2">
                    <i class="bi bi-whatsapp me-2"></i> WhatsApp SMS
                </a>
            </li>

        </ul>
    </li>

    <!-- Diwali Kirana Section -->
    <li>
        <a href="#diwaliSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="text-decoration-none text-dark d-block py-2">
            <i class="bi bi-brightness-high-fill me-2"></i> Diwali Kirana
        </a>
        <ul class="collapse list-unstyled submenu" id="diwaliSubmenu">
            <li>
                <a href="{% url 'rationcardscan' %}" class="text-decoration-none text-dark d-block py-2">
                    <i class="bi bi-patch-check me-2"></i> Verify Kit Delivery
                </a>
            </li>
            <li>
                <a href="{% url 'diwali_report_page' %}" class="text-decoration-none text-dark d-block py-2">
                    <i class="bi bi-file-earmark-arrow-down me-2"></i> Download Report
                </a>
            </li>
            <li>
                <a href="{% url 'diwali_all_registrations' %}" class="text-decoration-none text-dark d-block py-2">
                    <i class="bi bi-list-ul me-2"></i> View All Registrations
                </a>
            </li>
                         <li>
                <a href="{% url 'darshan_yatra_management' %}" class="text-decoration-none text-dark d-block py-2">
                    <i class="bi bi-people me-2"></i> Add Membar
                </a>
            </li>
        </ul>
    </li>

    <!-- Event Management Section -->
    <li>
        <a href="#eventSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="text-decoration-none text-dark d-block py-2">
            <i class="bi bi-calendar-event me-2"></i> Event Management
        </a>
        <ul class="collapse list-unstyled submenu" id="eventSubmenu">
            <li>
              <a href="{% url 'event_list_page' %}" class="text-decoration-none text-dark d-block py-2">
                <i class="bi bi-calendar-event me-2"></i> Event List
              </a>
            </li>
            <li>
              <a href="{% url 'qr_scanner_page' %}" class="text-decoration-none text-dark d-block py-2">
                <i class="bi bi-qr-code-scan me-2"></i> QR Scan
              </a>
            </li>
        </ul>
    </li>

    <li>
        <a href="{% url 'logout' %}" class="text-decoration-none text-dark d-block py-2">
            <i class="bi bi-box-arrow-right me-2"></i> Logout
        </a>
    </li>
</ul>
</div>


<!-- main content -->
<div class="container-home">
    {% if request.session.user_role == "1" %}
        <!-- Admin: full access -->
        <a href="{% url 'dashboard' %}" class="home-button btn-registration">
            <i class="bi bi-person-plus-fill me-2"></i> Yatra Booking
        </a>
        <a href="{% url 'diwali_yatra_page' %}" class="home-button btn-diwali">
            <i class="bi bi-brightness-high-fill me-2"></i> Diwali Kirana
        </a>
       <a href="{% url 'event_list_page' %}" class="home-button btn-event">
            <i class="bi bi-calendar-event-fill me-2"></i> Event Management
            </a>
    {% elif request.session.user_role == "2" %}
        <!-- Operator: cannot access Yatra Booking -->
        <a href="{% url 'diwali_yatra_page' %}" class="home-button btn-diwali">
            <i class="bi bi-brightness-high-fill me-2"></i> Diwali Kirana
        </a>
        <a href="{% url 'event_list_page' %}" class="home-button btn-event">
            <i class="bi bi-calendar-event-fill me-2"></i> Event Management
    {% else %}
        <!-- Other roles, only show Diwali Kirana -->
        <a href="{% url 'diwali_yatra_page' %}" class="home-button btn-diwali">
            <i class="bi bi-brightness-high-fill me-2"></i> Diwali Kirana
        </a>
        <a href="{% url 'event_list_page' %}" class="home-button btn-event">
            <i class="bi bi-calendar-event-fill me-2"></i> Event Management
    {% endif %}
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // drawer functionality
  const menuBtn = document.getElementById('menuBtn'), drawer = document.getElementById('drawer');
  menuBtn.addEventListener('click', ()=> drawer.classList.add('open'));
  function closeDrawer(){ drawer.classList.remove('open'); }
  window.addEventListener('click', (e)=> { if (!drawer.contains(e.target) && !menuBtn.contains(e.target)) closeDrawer(); });
</script>

</body>
</html>